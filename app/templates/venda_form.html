{% extends "base.html" %}

{% block conteudo %}
<h1 class="titulo-pagina">Nova Venda</h1>

<form method="post" class="formulario">
    <div class="form-linha">
        <label for="cliente_id">Cliente:</label>
        <select name="cliente_id" required>
            <option value="">Selecione</option>
            {% for cliente in clientes %}
            <option value="{{ cliente.id }}">{{ cliente.nome }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-linha">
        <label for="forma_pagamento">Forma de Pagamento:</label>
        <select name="forma_pagamento" required>
            <option value="avista">Ã€ Vista</option>
            <option value="aprazo">A Prazo</option>
        </select>
    </div>

    <h3>Produtos:</h3>
    <div id="produtos-container">
        <div class="produto-linha">
            <select name="produto_id" required>
                <option value="">Selecione</option>
                {% for produto in produtos %}
                <option value="{{ produto.id }}">{{ produto.nome }} - R$ {{ '%.2f'|format(produto.preco_venda or 0) }}</option>
                {% endfor %}
            </select>
            <input type="number" name="quantidade" placeholder="Quantidade" min="1" required>
            <button type="button" onclick="removerLinha(this)">Remover</button>
        </div>
    </div>

    <button type="button" onclick="adicionarLinha()">+ Adicionar Produto</button>

    <div class="form-linha">
        <label for="desconto">Desconto (R$):</label>
        <input type="number" name="desconto" step="0.01" value="0">
    </div>

    <button type="submit" class="btn-principal">Salvar Venda</button>
</form>

<script>
function adicionarLinha() {
    const container = document.getElementById("produtos-container");
    const novaLinha = container.children[0].cloneNode(true);
    novaLinha.querySelector("select").value = "";
    novaLinha.querySelector("input").value = "";
    container.appendChild(novaLinha);
}

function removerLinha(btn) {
    const linha = btn.parentElement;
    const container = document.getElementById("produtos-container");
    if (container.children.length > 1) {
        container.removeChild(linha);
    }
}
</script>
{% endblock %}
